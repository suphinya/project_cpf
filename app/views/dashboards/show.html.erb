<h1 class="headerer">
	<%= link_to 'Assign shift', root_path %>
</h1>


<h1> 
	<%= @department_name %> 
</h1>

<div id = "pick_time">
	<%= form_tag dashboard_path(@department_name) , :method => :get do %>
		เลือกกะการทำงาน :    
		<%= select_tag 'time_in', options_for_select(@all_time, @select)  %>
		<%= submit_tag 'choose' , :name => "choose"  %>
	<% end %>
</div>

<%= link_to 'Plan', edit_dashboard_path(@department_name) %><br>
<% day = Time.current.strftime("%Y-%m-%d") %>
<% date = day.to_time %>

<table id = "employee_work">
	<thead>
		<tr>
			<th> ชื่อ-นามสกุล </th>
			<th> เวลาเข้างาน </th>
			<th> เวลาออกงาน </th>
			<th> OT </th>
		</tr>
	</thead>
	<tbody>
		<% @all_workers.each do |worker| %>
			<tr>
				<td><%= worker.name + " " + worker.surname %></td>
				<% worker_all_actuals = worker.actuals.find_by_date(date) %>
				<% if @select == "all" %>
					<% worker_all_plan = worker.plans.find_by_date(date) %>
				<% else %>
					<% worker_all_plan = worker.plans.find_by(:date => date , :time_in => @t_in) %>
				<% end %>

				<% if worker_all_actuals != nil && worker_all_plan != nil  %>

					<% if worker_all_actuals.time_in != nil  %>
						<td><%= worker_all_actuals.time_in.strftime('%H:%M:%S') + '/' + (worker_all_plan.time_in + (3600*12)).strftime('%H:%M:%S') %></td>
					<% else %>
						<td> - </td>
					<% end %>

					<% if worker_all_actuals.time_out != nil %>
						<td><%= worker_all_actuals.time_out.strftime('%H:%M:%S') + '/' + (worker_all_plan.time_out+(3600*12)).strftime('%H:%M:%S')%></td>
					<% else %>
						<td> - </td>
					<% end %>

					<% if worker_all_actuals.OT != nil %>
						<td><%= worker_all_actuals.OT.to_s + '/' + worker_all_plan.OT.to_s %></td>
					<% else %>
						<td> - </td>
					<% end %>

				<% else %>
					<% if worker_all_plan != nil %>
						<td> <%= '- / ' + worker_all_plan.time_in.strftime('%H:%M:%S') %></td>
						<td> <%= '- / ' + worker_all_plan.time_out.strftime('%H:%M:%S') %></td>
						<td> <%= '- / ' + worker_all_plan.OT.to_s %></td>
					<% else %>
						<td> - </td>
						<td> - </td>
						<td> - </td>
					<% end %>
				<% end %>
			</tr>
		<% end %>
	</tbody>
</table>
